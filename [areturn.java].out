.DATA
VT_Object:
DW 0  ; VT vacía
VT_String:
DW 0  ; VT vacía
VT_System:
DW 0  ; VT vacía
VT_A:
DW A_getRef, A_getNum
VT_B:
DW 0  ; VT vacía
VT_Main:
DW 0  ; VT vacía
.CODE
PUSH simple_heap_init
CALL
PUSH main
CALL
HALT
simple_heap_init:
RET 0
simple_malloc:
LOADFP
LOADSP
STOREFP
LOADHL
DUP
PUSH 1
ADD
STORE 4
LOAD 3
ADD
STOREHL
STOREFP
RET 1
ctor_Object:
LOADFP
LOADSP
STOREFP
STOREFP
RET 1
ctor_String:
LOADFP
LOADSP
STOREFP
STOREFP
RET 1
ctor_System:
LOADFP
LOADSP
STOREFP
STOREFP
RET 1
; Clase Object
Object_debugPrint:
LOADFP
LOADSP
STOREFP
LOAD 3
IPRINT
STOREFP
RET 1
; Clase System
System_read:
LOADFP
LOADSP
STOREFP
READ
STORE 3
STOREFP
RET 0
System_printB:
LOADFP
LOADSP
STOREFP
LOAD 3
BPRINT
STOREFP
RET 1
System_printC:
LOADFP
LOADSP
STOREFP
LOAD 3
CPRINT
STOREFP
RET 1
System_printI:
LOADFP
LOADSP
STOREFP
LOAD 3
IPRINT
STOREFP
RET 1
System_printS:
LOADFP
LOADSP
STOREFP
LOAD 3
SPRINT
STOREFP
RET 1
System_println:
LOADFP
LOADSP
STOREFP
PRNLN
STOREFP
RET 0
System_printBln:
LOADFP
LOADSP
STOREFP
LOAD 3
BPRINT
PRNLN
STOREFP
RET 1
System_printCln:
LOADFP
LOADSP
STOREFP
LOAD 3
CPRINT
PRNLN
STOREFP
RET 1
System_printIln:
LOADFP
LOADSP
STOREFP
LOAD 3
IPRINT
PRNLN
STOREFP
RET 1
System_printSln:
LOADFP
LOADSP
STOREFP
LOAD 3
SPRINT
PRNLN
STOREFP
RET 1
ctor_A:
LOADFP
LOADSP
STOREFP
STOREFP
RET 1
A_getNewA:
LOADFP
LOADSP
STOREFP
RMEM 1
RMEM 1
PUSH 2
PUSH simple_malloc
CALL
DUP
PUSH VT_A
STOREREF 0
DUP
PUSH ctor_A
CALL
STORE 0
PUSH 1
LOAD 0
SWAP
STOREREF 1
LOAD 0
STORE 3
JUMP end_method_A_getNewA
NOP
end_method_A_getNewA:
FMEM 1
STOREFP
RET 0
A_getRef:
LOADFP
LOADSP
STOREFP
LOAD 3
STORE 4
JUMP end_method_A_getRef
NOP
end_method_A_getRef:
STOREFP
RET 1
A_getNum:
LOADFP
LOADSP
STOREFP
LOAD 3
LOADREF 1
PUSH 1
    SUB
STORE 4
JUMP end_method_A_getNum
NOP
end_method_A_getNum:
STOREFP
RET 1
ctor_B:
LOADFP
LOADSP
STOREFP
LOAD 4
PUSH 2
    MUL
LOAD 3
SWAP
STOREREF 1
STOREFP
RET 2
B_getNewB:
LOADFP
LOADSP
STOREFP
RMEM 1
PUSH 2
PUSH simple_malloc
CALL
DUP
PUSH VT_B
STOREREF 0
DUP
PUSH 15
SWAP
PUSH ctor_B
CALL
STORE 3
JUMP end_method_B_getNewB
NOP
end_method_B_getNewB:
STOREFP
RET 0
ctor_Main:
LOADFP
LOADSP
STOREFP
STOREFP
RET 1
Main_getNum:
LOADFP
LOADSP
STOREFP
PUSH 1
BF else_5
LOAD 3
RMEM 1
SWAP
DUP
LOADREF 0 
LOADREF 0
CALL
RMEM 1
SWAP
DUP
LOADREF 0 
LOADREF 1
CALL
STORE 4
JUMP end_method_Main_getNum
else_5:
PUSH str_0
PUSH System_printSln
CALL
PUSH 0
STORE 4
JUMP end_method_Main_getNum
NOP
end_method_Main_getNum:
STOREFP
RET 1
main:
LOADFP
LOADSP
STOREFP
RMEM 1
RMEM 1
PUSH A_getNewA
CALL
STORE 0
RMEM 1
RMEM 1
PUSH 2
PUSH simple_malloc
CALL
DUP
PUSH VT_B
STOREREF 0
DUP
PUSH 21
SWAP
PUSH ctor_B
CALL
STORE -1
LOAD 0
LOADREF 1
PUSH System_printIln
CALL
LOAD 0
RMEM 1
SWAP
DUP
LOADREF 0 
LOADREF 0
CALL
LOADREF 1
LOAD -1
POP
RMEM 1
PUSH B_getNewB
CALL
LOADREF 1
    ADD
LOAD 0
RMEM 1
SWAP
DUP
LOADREF 0 
LOADREF 0
CALL
SWAP
STOREREF 1
RMEM 1
LOAD 0
PUSH Main_getNum
CALL
PUSH System_printIln
CALL
RMEM 1
LOAD 0
RMEM 1
SWAP
DUP
LOADREF 0 
LOADREF 0
CALL
PUSH Main_getNum
CALL
PUSH System_printIln
CALL
JUMP end_method_main
NOP
end_method_main:
FMEM 2
STOREFP
RET 0
.DATA
str_0: DW "Esto no se deberia imprimir", 0
